<p>In a previous article I described how to create a <a href="https://www.javelin-tech.com/blog/2013/08/solidworks-pdm-sandbox-vault-for-modification-and-troubleshooting/" rel="noopener" target="_blank">Sandbox Vault</a>. This will create a new vault with the same vault settings, but it does not copy the Database or the Archive. We can copy the Database and the Archive or parts of the archive using <a href="https://www.javelin-tech.com/blog/2011/06/epdm-support-info/" rel="noopener" target="_blank">Collect Support Information</a>. In this article, we will look at how to bring all those pieces together, in order to create a duplicate SOLIDWORKS PDM Vault.</p>
<p>The first step is create a the <a href="https://www.javelin-tech.com/blog/2013/08/epdm-sandbox-vault/" rel="noopener" target="_blank">Sandbox Vault</a>, making sure to select an Empty Predefined Vault. In the <a href="https://www.javelin-tech.com/blog/2013/08/solidworks-pdm-sandbox-vault-for-modification-and-troubleshooting/" rel="noopener" target="_blank">Sandbox Vault</a>  article, the last step is to import the vault settings. We’ll put this off until later.</p>
<div class="wp-caption aligncenter" id="attachment_29936" style="width: 555px"><img alt="Create a duplicate SOLIDWORKS PDM Vault" aria-describedby="caption-attachment-29936" height="510" src="/assets/images/empty-vault.png" title="" width="545"/><p class="wp-caption-text" id="caption-attachment-29936"><noscript><img alt="Create a duplicate SOLIDWORKS PDM Vault" height="510" sizes="(max-width: 545px) 100vw, 545px" src="/assets/images/empty-vault.png" title="" width="545"/></noscript> Create New Vault</p></div>
<p>Once we have an empty Vault, we restore the Database through SQL Management Studio. After logging into SQL Management Studio, right-click on the Databases folder and select restore.</p>
<div class="wp-caption aligncenter" id="attachment_29940" style="width: 309px"><img alt="Restore Database" aria-describedby="caption-attachment-29940" height="246" src="/assets/images/Rightclick-Restore.png" title="" width="299"/><p class="wp-caption-text" id="caption-attachment-29940"><noscript><img alt="Restore Database" height="246" src="/assets/images/Rightclick-Restore.png" title="" width="299"/></noscript> Restore Database</p></div>
<p> </p>
<p>In the General tab, for Source, select Device and hit the browse button. Click on Add to select the backup that was created earlier.</p>
<div class="wp-caption aligncenter" id="attachment_29939" style="width: 667px"><img alt="Select backup devices" aria-describedby="caption-attachment-29939" height="504" src="/assets/images/select-backup.png" title="" width="657"/><p class="wp-caption-text" id="caption-attachment-29939"><noscript><img alt="Select backup devices" height="504" sizes="(max-width: 657px) 100vw, 657px" src="/assets/images/select-backup.png" title="" width="657"/></noscript> Select backup devices</p></div>
<p>Back in the General tab, set the Destination Database, to the <a href="https://www.javelin-tech.com/blog/2013/08/solidworks-pdm-sandbox-vault-for-modification-and-troubleshooting/" rel="noopener" target="_blank">Sandbox Vault</a>.</p>
<div class="wp-caption aligncenter" id="attachment_29937" style="width: 873px"><img alt="Restore Database" aria-describedby="caption-attachment-29937" height="419" src="/assets/images/Destination-DB.png" title="" width="863"/><p class="wp-caption-text" id="caption-attachment-29937"><noscript><img alt="Restore Database" height="419" sizes="(max-width: 863px) 100vw, 863px" src="/assets/images/Destination-DB.png" title="" width="863"/></noscript> Restore Database</p></div>
<p> </p>
<p>Under options, select ‘Overwrite the existing database (WITH REPLACE)’ , deselect ‘Take tail-log backup before restore’ and select ‘Close existing connections to destination database’.</p>
<div class="wp-caption aligncenter" id="attachment_29941" style="width: 872px"><img alt="Overwrite the existing database (WITH REPLACE)" aria-describedby="caption-attachment-29941" height="512" src="/assets/images/Restore-options-1.png" title="" width="862"/><p class="wp-caption-text" id="caption-attachment-29941"><noscript><img alt="Overwrite the existing database (WITH REPLACE)" height="512" sizes="(max-width: 862px) 100vw, 862px" src="/assets/images/Restore-options-1.png" title="" width="862"/></noscript> Overwrite the existing database (WITH REPLACE)</p></div>
<p>Next click OK to restore the vault.</p>
<p>Now that we have restored the production database, over top of the Sandbox database, we can copy the Archive folders, from our production vault, to our Sandbox vault. We can copy all of the archive sub-folders, but the archive folder can be massive.</p>
<div class="wp-caption aligncenter" id="attachment_30013" style="width: 472px"><img alt="Archive sub-folders" aria-describedby="caption-attachment-30013" height="404" src="/assets/images/copy-arhive.png" title="" width="462"/><p class="wp-caption-text" id="caption-attachment-30013"><noscript><img alt="Archive sub-folders" height="404" sizes="(max-width: 462px) 100vw, 462px" src="/assets/images/copy-arhive.png" title="" width="462"/></noscript> Archive sub-folders</p></div>
<p>We are likely better off to use <a href="https://www.javelin-tech.com/blog/2011/06/epdm-support-info/" rel="noopener" target="_blank">Collect Support Information,</a> to copy only the files and/or folders we want work with.</p>
<p>There are some changes that we need to make in SQL Management Studio. In Object Explorer Expand Databases&gt;Your Sandbox database&gt;Tables&gt;File Tables, right click dbo.ArchiveServers and select Edit Top 200 Rows</p>
<div class="wp-caption aligncenter" id="attachment_30015" style="width: 372px"><img alt="Edit Top 200 Rows" aria-describedby="caption-attachment-30015" height="170" src="/assets/images/edit-dbo_ArchiveServers.png" title="" width="362"/><p class="wp-caption-text" id="caption-attachment-30015"><noscript><img alt="Edit Top 200 Rows" height="170" sizes="(max-width: 362px) 100vw, 362px" src="/assets/images/edit-dbo_ArchiveServers.png" title="" width="362"/></noscript> Edit Top 200 Rows</p></div>
<p>Change the Vault Name, so that it matches that of your Sandbox vault.</p>
<div class="wp-caption aligncenter" id="attachment_30014" style="width: 546px"><img alt="Change the Vault Name" aria-describedby="caption-attachment-30014" height="101" src="/assets/images/ArchiveServer-Vault-Name.png" title="" width="536"/><p class="wp-caption-text" id="caption-attachment-30014"><noscript><img alt="Change the Vault Name" height="101" sizes="(max-width: 536px) 100vw, 536px" src="/assets/images/ArchiveServer-Vault-Name.png" title="" width="536"/></noscript> Change the Vault Name</p></div>
<p>Next, do the same for dbo.SystemInfo (also found in Databases &gt; Your Sandbox database &gt; Tables &gt; File Tables)</p>
<div class="wp-caption aligncenter" id="attachment_30016" style="width: 550px"><img alt="dbo.SystemInfo" aria-describedby="caption-attachment-30016" height="95" src="/assets/images/dbosysteminfo-vault.png" title="" width="540"/><p class="wp-caption-text" id="caption-attachment-30016"><noscript><img alt="dbo.SystemInfo" height="95" sizes="(max-width: 540px) 100vw, 540px" src="/assets/images/dbosysteminfo-vault.png" title="" width="540"/></noscript> dbo.SystemInfo</p></div>
<p>To update all the SQL and PDM settings, restart SQL Server service if possible. If not, then restart PDM Database and Archive Service.</p>
<div class="wp-caption aligncenter" id="attachment_30017" style="width: 790px"><a href="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/restart-services.png"><img alt="Restart Vault" aria-describedby="caption-attachment-30017" height="86" src="/assets/images/restart-services-780x86.png" title="" width="780"/><p class="wp-caption-text" id="caption-attachment-30017"><noscript><img alt="Restart Vault" height="86" sizes="(max-width: 780px) 100vw, 780px" src="/assets/images/restart-services-780x86.png" title="" width="780"/></noscript></p></a> Restart Vault</div>
<p>The last step is to import the vault settings, as described in my <a href="https://www.javelin-tech.com/blog/2013/08/solidworks-pdm-sandbox-vault-for-modification-and-troubleshooting/" rel="noopener" target="_blank">Sandbox Vault</a> blog</p>
<p>If you experience any problems connecting to the vault, edit the Windows Registry and check that settings for Sandbox vault are correct. Ensure that everything is pointing correct locations. Below are the keys that should be checked.</p>
<pre>HKEY_LOCAL_MACHINE\SOFTWARE\SolidWorks\Applications\PDMWorks Enterprise\ArchiveServer\Vaults

HKEY_LOCAL_MACHINE\SOFTWARE\SolidWorks\Applications\PDMWorks Enterprise\ArchiveServer\Vaults\ACME_Sandbox\ArchiveTable

HKEY_LOCAL_MACHINE\SOFTWARE\SolidWorks\Applications\PDMWorks Enterprise\ArchiveServer\Vaults

HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\SolidWorks\Applications\PDMWorks Enterprise\Databases</pre>
