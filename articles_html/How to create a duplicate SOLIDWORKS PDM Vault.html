<p>In a previous article I described how to create a <a href="https://www.javelin-tech.com/blog/2013/08/solidworks-pdm-sandbox-vault-for-modification-and-troubleshooting/" target="_blank" rel="noopener">Sandbox Vault</a>. This will create a new vault with the same vault settings, but it does not copy the Database or the Archive. We can copy the Database and the Archive or parts of the archive using <a href="https://www.javelin-tech.com/blog/2011/06/epdm-support-info/" target="_blank" rel="noopener">Collect Support Information</a>. In this article, we will look at how to bring all those pieces together, in order to create a duplicate SOLIDWORKS PDM Vault.</p>
<p>The first step is create a the <a href="https://www.javelin-tech.com/blog/2013/08/epdm-sandbox-vault/" target="_blank" rel="noopener">Sandbox Vault</a>, making sure to select an Empty Predefined Vault. In the <a href="https://www.javelin-tech.com/blog/2013/08/solidworks-pdm-sandbox-vault-for-modification-and-troubleshooting/" target="_blank" rel="noopener">Sandbox Vault</a>  article, the last step is to import the vault settings. We&#8217;ll put this off until later.</p>
<div id="attachment_29936" style="width: 555px" class="wp-caption aligncenter"><img decoding="async" aria-describedby="caption-attachment-29936" class="wp-image-29936 size-full lazyload" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/empty-vault.png" alt="Create a duplicate SOLIDWORKS PDM Vault" width="545" height="510" title=""><p id="caption-attachment-29936" class="wp-caption-text"><noscript><img decoding="async" class="wp-image-29936 size-full lazyload" src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/empty-vault.png" alt="Create a duplicate SOLIDWORKS PDM Vault" width="545" height="510" title="" srcset="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/empty-vault.png 545w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/empty-vault-300x281.png 300w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/empty-vault-170x160.png 170w" sizes="(max-width: 545px) 100vw, 545px" /></noscript> Create New Vault</p></div>
<p>Once we have an empty Vault, we restore the Database through SQL Management Studio. After logging into SQL Management Studio, right-click on the Databases folder and select restore.</p>
<div id="attachment_29940" style="width: 309px" class="wp-caption aligncenter"><img decoding="async" aria-describedby="caption-attachment-29940" class="wp-image-29940 size-full lazyload" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/Rightclick-Restore.png" alt="Restore Database" width="299" height="246" title=""><p id="caption-attachment-29940" class="wp-caption-text"><noscript><img decoding="async" class="wp-image-29940 size-full lazyload" src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/Rightclick-Restore.png" alt="Restore Database" width="299" height="246" title=""></noscript> Restore Database</p></div>
<p>&nbsp;</p>
<p>In the General tab, for Source, select Device and hit the browse button. Click on Add to select the backup that was created earlier.</p>
<div id="attachment_29939" style="width: 667px" class="wp-caption aligncenter"><img decoding="async" aria-describedby="caption-attachment-29939" class="wp-image-29939 size-full lazyload" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/select-backup.png" alt="Select backup devices" width="657" height="504" title=""><p id="caption-attachment-29939" class="wp-caption-text"><noscript><img decoding="async" class="wp-image-29939 size-full lazyload" src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/select-backup.png" alt="Select backup devices" width="657" height="504" title="" srcset="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/select-backup.png 657w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/select-backup-300x230.png 300w" sizes="(max-width: 657px) 100vw, 657px" /></noscript> Select backup devices</p></div>
<p>Back in the General tab, set the Destination Database, to the <a href="https://www.javelin-tech.com/blog/2013/08/solidworks-pdm-sandbox-vault-for-modification-and-troubleshooting/" target="_blank" rel="noopener">Sandbox Vault</a>.</p>
<div id="attachment_29937" style="width: 873px" class="wp-caption aligncenter"><img decoding="async" aria-describedby="caption-attachment-29937" class="wp-image-29937 size-full lazyload" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/Destination-DB.png" alt="Restore Database" width="863" height="419" title=""><p id="caption-attachment-29937" class="wp-caption-text"><noscript><img decoding="async" class="wp-image-29937 size-full lazyload" src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/Destination-DB.png" alt="Restore Database" width="863" height="419" title="" srcset="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/Destination-DB.png 863w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/Destination-DB-300x146.png 300w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/Destination-DB-768x373.png 768w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/Destination-DB-780x379.png 780w" sizes="(max-width: 863px) 100vw, 863px" /></noscript> Restore Database</p></div>
<p>&nbsp;</p>
<p>Under options, select &#8216;Overwrite the existing database (WITH REPLACE)&#8217; , deselect &#8216;Take tail-log backup before restore&#8217; and select &#8216;Close existing connections to destination database&#8217;.</p>
<div id="attachment_29941" style="width: 872px" class="wp-caption aligncenter"><img decoding="async" aria-describedby="caption-attachment-29941" class="wp-image-29941 size-full lazyload" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/Restore-options-1.png" alt="Overwrite the existing database (WITH REPLACE)" width="862" height="512" title=""><p id="caption-attachment-29941" class="wp-caption-text"><noscript><img decoding="async" class="wp-image-29941 size-full lazyload" src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/Restore-options-1.png" alt="Overwrite the existing database (WITH REPLACE)" width="862" height="512" title="" srcset="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/Restore-options-1.png 862w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/Restore-options-1-300x178.png 300w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/Restore-options-1-768x456.png 768w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/Restore-options-1-780x463.png 780w" sizes="(max-width: 862px) 100vw, 862px" /></noscript> Overwrite the existing database (WITH REPLACE)</p></div>
<p>Next click OK to restore the vault.</p>
<p>Now that we have restored the production database, over top of the Sandbox database, we can copy the Archive folders, from our production vault, to our Sandbox vault. We can copy all of the archive sub-folders, but the archive folder can be massive.</p>
<div id="attachment_30013" style="width: 472px" class="wp-caption aligncenter"><img decoding="async" aria-describedby="caption-attachment-30013" class="wp-image-30013 size-full lazyload" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/copy-arhive.png" alt="Archive sub-folders" width="462" height="404" title=""><p id="caption-attachment-30013" class="wp-caption-text"><noscript><img decoding="async" class="wp-image-30013 size-full lazyload" src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/copy-arhive.png" alt="Archive sub-folders" width="462" height="404" title="" srcset="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/copy-arhive.png 462w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/copy-arhive-300x262.png 300w" sizes="(max-width: 462px) 100vw, 462px" /></noscript> Archive sub-folders</p></div>
<p>We are likely better off to use <a href="https://www.javelin-tech.com/blog/2011/06/epdm-support-info/" target="_blank" rel="noopener">Collect Support Information,</a> to copy only the files and/or folders we want work with.</p>
<p>There are some changes that we need to make in SQL Management Studio. In Object Explorer Expand Databases&gt;Your Sandbox database&gt;Tables&gt;File Tables, right click dbo.ArchiveServers and select Edit Top 200 Rows</p>
<div id="attachment_30015" style="width: 372px" class="wp-caption aligncenter"><img decoding="async" aria-describedby="caption-attachment-30015" class="wp-image-30015 size-full lazyload" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/edit-dbo_ArchiveServers.png" alt="Edit Top 200 Rows" width="362" height="170" title=""><p id="caption-attachment-30015" class="wp-caption-text"><noscript><img decoding="async" class="wp-image-30015 size-full lazyload" src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/edit-dbo_ArchiveServers.png" alt="Edit Top 200 Rows" width="362" height="170" title="" srcset="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/edit-dbo_ArchiveServers.png 362w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/edit-dbo_ArchiveServers-300x141.png 300w" sizes="(max-width: 362px) 100vw, 362px" /></noscript> Edit Top 200 Rows</p></div>
<p>Change the Vault Name, so that it matches that of your Sandbox vault.</p>
<div id="attachment_30014" style="width: 546px" class="wp-caption aligncenter"><img decoding="async" aria-describedby="caption-attachment-30014" class="wp-image-30014 size-full lazyload" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/ArchiveServer-Vault-Name.png" alt="Change the Vault Name" width="536" height="101" title=""><p id="caption-attachment-30014" class="wp-caption-text"><noscript><img decoding="async" class="wp-image-30014 size-full lazyload" src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/ArchiveServer-Vault-Name.png" alt="Change the Vault Name" width="536" height="101" title="" srcset="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/ArchiveServer-Vault-Name.png 536w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/ArchiveServer-Vault-Name-300x57.png 300w" sizes="(max-width: 536px) 100vw, 536px" /></noscript> Change the Vault Name</p></div>
<p>Next, do the same for dbo.SystemInfo (also found in Databases &gt; Your Sandbox database &gt; Tables &gt; File Tables)</p>
<div id="attachment_30016" style="width: 550px" class="wp-caption aligncenter"><img decoding="async" aria-describedby="caption-attachment-30016" class="wp-image-30016 size-full lazyload" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/dbosysteminfo-vault.png" alt="dbo.SystemInfo" width="540" height="95" title=""><p id="caption-attachment-30016" class="wp-caption-text"><noscript><img decoding="async" class="wp-image-30016 size-full lazyload" src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/dbosysteminfo-vault.png" alt="dbo.SystemInfo" width="540" height="95" title="" srcset="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/dbosysteminfo-vault.png 540w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/dbosysteminfo-vault-300x53.png 300w" sizes="(max-width: 540px) 100vw, 540px" /></noscript> dbo.SystemInfo</p></div>
<p>To update all the SQL and PDM settings, restart SQL Server service if possible. If not, then restart PDM Database and Archive Service.</p>
<div id="attachment_30017" style="width: 790px" class="wp-caption aligncenter"><a href="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/restart-services.png"><img decoding="async" aria-describedby="caption-attachment-30017" class="wp-image-30017 size-large lazyload" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/restart-services-780x86.png" alt="Restart Vault" width="780" height="86" title=""><p id="caption-attachment-30017" class="wp-caption-text"><noscript><img decoding="async" class="wp-image-30017 size-large lazyload" src="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/restart-services-780x86.png" alt="Restart Vault" width="780" height="86" title="" srcset="https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/restart-services-780x86.png 780w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/restart-services-300x33.png 300w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/restart-services-768x85.png 768w, https://www.javelin-tech.com/blog/wp-content/uploads/2017/09/restart-services.png 869w" sizes="(max-width: 780px) 100vw, 780px" /></noscript></a> Restart Vault</p></div>
<p>The last step is to import the vault settings, as described in my <a href="https://www.javelin-tech.com/blog/2013/08/solidworks-pdm-sandbox-vault-for-modification-and-troubleshooting/" target="_blank" rel="noopener">Sandbox Vault</a> blog</p>
<p>If you experience any problems connecting to the vault, edit the Windows Registry and check that settings for Sandbox vault are correct. Ensure that everything is pointing correct locations. Below are the keys that should be checked.</p>
<pre>HKEY_LOCAL_MACHINE\SOFTWARE\SolidWorks\Applications\PDMWorks Enterprise\ArchiveServer\Vaults
HKEY_LOCAL_MACHINE\SOFTWARE\SolidWorks\Applications\PDMWorks Enterprise\ArchiveServer\Vaults\ACME_Sandbox\ArchiveTable
HKEY_LOCAL_MACHINE\SOFTWARE\SolidWorks\Applications\PDMWorks Enterprise\ArchiveServer\Vaults
HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\SolidWorks\Applications\PDMWorks Enterprise\Databases</pre>
